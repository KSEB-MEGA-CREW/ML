<!DOCTYPE html>
<html>
  <head>
    <title>AI ì„œë²„ WebSocket í…ŒìŠ¤íŠ¸</title>
  </head>
  <body>
    <h1>AI ì„œë²„ WebSocket ì—°ê²° í…ŒìŠ¤íŠ¸</h1>

    <div>
      <label>JWT í† í°:</label>
      <input
        type="text"
        id="token"
        placeholder="your-jwt-token"
        style="width: 500px"
      />
    </div>

    <div style="margin: 10px 0">
      <button onclick="connectWebSocket()">ì—°ê²°í•˜ê¸°</button>
      <button onclick="sendTestFrame()">í…ŒìŠ¤íŠ¸ í”„ë ˆì„ ì „ì†¡</button>
      <button onclick="disconnect()">ì—°ê²° í•´ì œ</button>
    </div>

    <div>
      <h3>ì—°ê²° ìƒíƒœ:</h3>
      <div id="status">ì—°ê²°ë˜ì§€ ì•ŠìŒ</div>
    </div>

    <div>
      <h3>ìˆ˜ì‹  ë©”ì‹œì§€:</h3>
      <div
        id="messages"
        style="
          border: 1px solid #ccc;
          height: 300px;
          overflow-y: scroll;
          padding: 10px;
        "
      ></div>
    </div>

    <script>
      let ws = null;

      function connectWebSocket() {
        const token = document.getElementById("token").value;
        if (!token) {
          alert("JWT í† í°ì„ ì…ë ¥í•˜ì„¸ìš”");
          return;
        }

        const wsUrl = `ws://localhost:8000/ws?token=${encodeURIComponent(
          token
        )}`;
        console.log("ğŸ”Œ ì—°ê²° ì‹œë„:", wsUrl);

        ws = new WebSocket(wsUrl);

        ws.onopen = function () {
          console.log("âœ… WebSocket ì—°ê²° ì„±ê³µ");
          document.getElementById("status").textContent = "ì—°ê²°ë¨";
          document.getElementById("status").style.color = "green";
          addMessage("âœ… ì—°ê²° ì„±ê³µ");
        };

        ws.onmessage = function (event) {
          const data = JSON.parse(event.data);
          console.log("ğŸ“¥ ìˆ˜ì‹  ë©”ì‹œì§€:", data);
          addMessage(`ğŸ“¥ ìˆ˜ì‹ : ${JSON.stringify(data, null, 2)}`);
        };

        ws.onclose = function (event) {
          console.log("ğŸ”Œ ì—°ê²° ì¢…ë£Œ:", event.code, event.reason);
          document.getElementById("status").textContent = "ì—°ê²° í•´ì œë¨";
          document.getElementById("status").style.color = "red";
          addMessage(`ğŸ”Œ ì—°ê²° ì¢…ë£Œ: ${event.code} - ${event.reason}`);
        };

        ws.onerror = function (error) {
          console.error("âŒ WebSocket ì˜¤ë¥˜:", error);
          addMessage("âŒ ì—°ê²° ì˜¤ë¥˜ ë°œìƒ");
        };
      }

      function sendTestFrame() {
        if (!ws || ws.readyState !== WebSocket.OPEN) {
          alert("ë¨¼ì € WebSocketì— ì—°ê²°í•˜ì„¸ìš”");
          return;
        }

        // í…ŒìŠ¤íŠ¸ìš© í‚¤í¬ì¸íŠ¸ ë°ì´í„° (194ê°œ ë”ë¯¸ ê°’)
        const testKeypoints = Array(194).fill(0.5);

        const message = {
          keypoints: [testKeypoints], // 1í”„ë ˆì„
          frame_index: Date.now(),
          timestamp: Date.now(),
        };

        console.log("ğŸ“¤ ì „ì†¡ ë©”ì‹œì§€:", message);
        ws.send(JSON.stringify(message));
        addMessage(
          `ğŸ“¤ ì „ì†¡: í…ŒìŠ¤íŠ¸ í”„ë ˆì„ (${testKeypoints.length}ê°œ í‚¤í¬ì¸íŠ¸)`
        );
      }

      function disconnect() {
        if (ws) {
          ws.close();
          ws = null;
        }
      }

      function addMessage(message) {
        const messagesDiv = document.getElementById("messages");
        const messageElement = document.createElement("div");
        messageElement.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
        messagesDiv.appendChild(messageElement);
        messagesDiv.scrollTop = messagesDiv.scrollHeight;
      }
    </script>
  </body>
</html>
